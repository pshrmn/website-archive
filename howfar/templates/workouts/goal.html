{% extends 'base.html' %}
{% load staticfiles %}

{% block stylesheets %}
{{ block.super }}
<link rel="stylesheet" type="text/css" href="{% static 'css/map.css' %}">
{% endblock stylesheets %}

{% block inline-css %}
#progress-bar {
    position: relative;
    width: 400px;
    height: 20px;
    padding: 5px 0;
}

.bar {
    height: 20px;
    width: 100%;
    position: absolute;
    top: 0;
    left: 0;
}

.total {
    background: rgba(171, 56, 78, 0.25);
}

.current {
    background: #AB384E;
}

.workout form {
    display: inline-block;
}

.city {
    fill: #AB384E
}

{% endblock inline-css %}

{% block content %}
<h1>
    {{ goal.start.name }} to {{ goal.end.name }}
</h1>
<h2>
    {{ goal.progress }}/{{ goal.length }} miles
</h2>
<div class="progress"></div>
<div class="map"></div>
<div>
    <ul>
    {% for workout in goal.workout_set.all %}
        <li class="workout">
            {{ workout.exercise }} for {{ workout.distance }} miles
            <form action="{% url 'delete_workout' workout.pk %}" method="post">
                {% csrf_token %}
                <button>&times;</button>
            </form>
        </li>
    {% empty %}
        <li>
            You have no saved workouts.
        </li>
    {% endfor %}
    </ul>
    {% if not goal.complete %}
        <a href="{% url 'add_workout' goal.pk %}">Add a workout.</a>
    {% endif %}
</div>
<div class="dangerous">
    <a href="{% url 'delete_goal' goal.pk %}">Delete Goal</a>
</div>
{% endblock content %}

{% block javascript %}
{{ block.super }}
<script src="{% static 'js/maps.js' %}" type="text/javascript"></script>
<script type="text/javascript" src="{% static 'js/goal.js' %}"></script>
{% endblock javascript %}

{% block inline-js %}
var total = {{ goal.length }};
var distances = [
    {% for workout in goal.workout_set.all %}
    {{ workout.distance }},
    {% endfor %}
];

var progress = {{ goal.progress }};
var percent = d3.min([(progress / total), 1]);

var startCity = {
    name: "{{ goal.start.name }}",
    latitude: {{ goal.start.latitude }},
    longitude: {{ goal.start.longitude }}  
};
var endCity = {
    name: "{{ goal.end.name }}",
    latitude: {{ goal.end.latitude }},
    longitude: {{ goal.end.longitude }}  
};
showProgress(total, distances);
drawGoal(startCity, endCity, percent, total);
{% endblock inline-js %}